var y=(l,r,o)=>{let n=o[0],{position:s,word:t}=n,c=[],f=new Set;for(;s+t.length<=r&&o.length!==0;){f.add(t),c.push({position:s,length:t.length});let i=s+t.length;for(o.shift();o.length!==0&&(n=o[0],s=n.position,t=n.word,i>s);)o.shift()}return{hits:c,start:l,end:r,count:f.size}},L=(l,r,o=!1)=>{let n=[],s=new Set;return l.forEach(t=>{let c=t.length;if(c===0)return;let f=0,i=-1;for(o||(r=r.toLowerCase(),t=t.toLowerCase()),i=r.indexOf(t,f);i>-1;)n.push({position:i,word:t}),s.add(t),f=i+c,i=r.indexOf(t,f)}),n.sort((t,c)=>t.position!==c.position?t.position-c.position:c.word.length-t.word.length),[n,s]},S=(l,r)=>{let o="",n=r.start;for(let{position:s,length:t}of r.hits)o+=l.substring(n,s),n=s+t,o+=`<mark class="search-keyword">${l.substr(s,t)}</mark>`;return o+=l.substring(n,r.end),o},b=(l,r,o)=>{if(!l){console.warn("`hexo-generator-searchdb` plugin is not installed!");return}let n=[],s=document.getElementById(r),t=document.getElementById(o),c=i=>{let p=[];return n.forEach(({title:e,content:m,url:h})=>{let[C,a]=L(i,e),[u,E]=L(i,m),x=new Set([...a,...E]).size,$=C.length+u.length;if($===0)return;let O=[];C.length!==0&&O.push(y(0,e.length,C));let I=[];for(;u.length!==0;){let d=u[0],{position:g}=d,M=Math.max(0,g-20),T=Math.min(m.length,g+80);I.push(y(M,T,u))}I.sort((d,g)=>d.count!==g.count?g.count-d.count:d.hits.length!==g.hits.length?g.hits.length-d.hits.length:d.start-g.start);let w="";h=new URL(h,location.origin),h.searchParams.append("highlight",i.join(" ")),O.length!==0?w+=`<li><a href="${h.href}" class="search-result-title">${S(e,O[0])}</a>`:w+=`<li><a href="${h.href}" class="search-result-title">${e}</a>`,I.forEach(d=>{w+=`<a href="${h.href}"><p class="search-result">${S(m,d)}...</p></a>`}),w+="</li>",p.push({item:w,id:p.length,hitCount:$,includedCount:x})}),p};(()=>{let i=!l.endsWith("json");fetch(l).then(p=>p.text()).then(p=>{n=i?[...new DOMParser().parseFromString(p,"text/xml").querySelectorAll("entry")].map(e=>({title:e.querySelector("title").textContent,content:e.querySelector("content").textContent,url:e.querySelector("url").textContent})):JSON.parse(p),n=n.filter(e=>e.title).map(e=>(e.title=e.title.trim(),e.content=e.content?e.content.trim().replace(/<[^>]+>/g,""):"",e.url=decodeURIComponent(e.url).replace(/\/{2,}/g,"/"),e)),s&&s.addEventListener("input",()=>{let e=s.value.trim().toLowerCase(),m=e.split(/[-\s]+/),h=[];e.length>0&&(h=c(m)),h.sort((a,u)=>a.includedCount!==u.includedCount?u.includedCount-a.includedCount:a.hitCount!==u.hitCount?u.hitCount-a.hitCount:u.id-a.id);let C=window.CONFIG.i18n.hits.replace(/\$\{hits}/,h.length);t.innerHTML=`<div class="search-stats">${C}</div>
            <ul class="search-result-list">${h.map(a=>a.item).join("")}</ul>`})})})()};document.addEventListener("DOMContentLoaded",()=>{b(window.CONFIG.local_search.path,"local-search-input","local-search-result")});
